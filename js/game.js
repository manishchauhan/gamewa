var ambientLight,hemisphereLight,shadowLight,sea,airplane,fieldDistance,energyBar,replayMessage,fieldLevel,levelCircle,Colors={red:15881030,white:14209233,brown:5845806,brownDark:2300175,pink:16095342,yellow:16043667,blue:6865856,darkGreen:26112,sky:65484,sea:3374287,yellow:16763904,stone:1707264},loopSound=null,hitSound=null,coinSound=null,deltaTime=0,newTime=new Date().getTime(),oldTime=new Date().getTime(),ennemiesPool=[],particlesPool=[],particlesInUse=[];function resetGame(){loopSound&&loopSound.play(),game={speed:0,initSpeed:35e-5,baseSpeed:35e-5,targetBaseSpeed:35e-5,incrementSpeedByTime:25e-7,incrementSpeedByLevel:5e-6,distanceForSpeedUpdate:100,speedLastUpdate:0,distance:0,ratioSpeedDistance:50,energy:100,ratioSpeedEnergy:3,level:1,levelLastUpdate:0,distanceForLevelUpdate:1e3,planeDefaultHeight:100,planeAmpHeight:80,planeAmpWidth:75,planeMoveSensivity:.005,planeRotXSensivity:8e-4,planeRotZSensivity:4e-4,planeFallSpeed:.001,planeMinSpeed:1.2,planeMaxSpeed:1.6,planeSpeed:0,planeCollisionDisplacementX:0,planeCollisionSpeedX:0,planeCollisionDisplacementY:0,planeCollisionSpeedY:0,seaRadius:600,seaLength:800,wavesMinAmp:5,wavesMaxAmp:20,wavesMinSpeed:.001,wavesMaxSpeed:.003,cameraFarPos:500,cameraNearPos:150,cameraSensivity:.002,coinDistanceTolerance:15,coinValue:3,coinsSpeed:.5,coinLastSpawn:0,distanceForCoinsSpawn:100,ennemyDistanceTolerance:10,ennemyValue:10,ennemiesSpeed:.6,ennemyLastSpawn:0,distanceForEnnemiesSpawn:50,coinTaken:0,status:"playing"},fieldLevel.innerHTML=Math.floor(game.level),coinTaken.innerHTML=game.coinTaken}var game,scene,camera,fieldOfView,aspectRatio,nearPlane,farPlane,renderer,container,controls,HEIGHT,WIDTH,mousePos={x:0,y:0};function createScene(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,scene=new THREE.Scene,aspectRatio=WIDTH/HEIGHT,fieldOfView=50,nearPlane=.1,farPlane=1e4,camera=new THREE.PerspectiveCamera(fieldOfView,aspectRatio,nearPlane,farPlane),scene.fog=new THREE.Fog(0,100,950),camera.position.x=0,camera.position.z=200,camera.position.y=game.planeDefaultHeight,(renderer=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setSize(WIDTH,HEIGHT),renderer.shadowMap.enabled=!0,(container=document.getElementById("world")).appendChild(renderer.domElement),window.addEventListener("resize",handleWindowResize,!1)}function handleWindowResize(){HEIGHT=window.innerHeight,WIDTH=window.innerWidth,renderer.setSize(WIDTH,HEIGHT),camera.aspect=WIDTH/HEIGHT,camera.updateProjectionMatrix()}function handleMouseMove(e){var a;mousePos={x:-1+e.clientX/WIDTH*2,y:1-e.clientY/HEIGHT*2}}function handleTouchMove(e){var a;mousePos={x:-1+e.touches[0].pageX/WIDTH*2,y:1-e.touches[0].pageY/HEIGHT*2}}function handleMouseUp(e){"waitingReplay"==game.status&&(resetGame(),hideReplay())}function handleTouchEnd(e){"waitingReplay"==game.status&&(resetGame(),hideReplay())}function createLights(){hemisphereLight=new THREE.HemisphereLight(11184810,0,.9),ambientLight=new THREE.AmbientLight(14452852,.5),(shadowLight=new THREE.DirectionalLight(16777215,.9)).position.set(150,350,350),shadowLight.castShadow=!0,shadowLight.shadow.camera.left=-400,shadowLight.shadow.camera.right=400,shadowLight.shadow.camera.top=400,shadowLight.shadow.camera.bottom=-400,shadowLight.shadow.camera.near=1,shadowLight.shadow.camera.far=1e3,shadowLight.shadow.mapSize.width=4096,shadowLight.shadow.mapSize.height=4096,new THREE.CameraHelper(shadowLight.shadow.camera),scene.add(hemisphereLight),scene.add(shadowLight),scene.add(ambientLight)}var Pilot=function(){this.mesh=new THREE.Object3D,this.mesh.name="pilot",this.angleHairs=0;var e=new THREE.BoxGeometry(15,15,15),a=new THREE.MeshPhongMaterial({color:Colors.brownDark,shading:THREE.FlatShading}),n=new THREE.Mesh(e,a);n.position.set(2,-12,0),this.mesh.add(n);var i=new THREE.BoxGeometry(10,10,10),s=new THREE.MeshLambertMaterial({color:Colors.red}),o=new THREE.Mesh(i,s);this.mesh.add(o);var t=new THREE.BoxGeometry(4,4,4),r=new THREE.MeshLambertMaterial({color:Colors.brownDark}),l=new THREE.Mesh(t,r);l.geometry.applyMatrix(new THREE.Matrix4().makeTranslation(0,2,0));var m=new THREE.Object3D;this.hairsTop=new THREE.Object3D;for(var h=0;h<12;h++){var d=l.clone(),p=h%3,c=Math.floor(h/3);d.position.set(-4+4*c,0,-4+4*p),d.geometry.applyMatrix(new THREE.Matrix4().makeScale(1,1,1)),this.hairsTop.add(d)}m.add(this.hairsTop);var $=new THREE.BoxGeometry(12,4,2);$.applyMatrix(new THREE.Matrix4().makeTranslation(-6,0,0));var g=new THREE.Mesh($,r),w=g.clone();g.position.set(8,-2,6),w.position.set(8,-2,-6),m.add(g),m.add(w);var y=new THREE.BoxGeometry(2,8,10),v=new THREE.Mesh(y,r);v.position.set(-1,-4,0),m.add(v),m.position.set(-5,5,0),this.mesh.add(m);var u=new THREE.BoxGeometry(5,5,5),f=new THREE.MeshLambertMaterial({color:Colors.brown}),_=new THREE.Mesh(u,f);_.position.set(6,0,3);var S=_.clone();S.position.z=-_.position.z;var M=new THREE.BoxGeometry(11,1,11),x=new THREE.Mesh(M,f);this.mesh.add(_),this.mesh.add(S),this.mesh.add(x);var T=new THREE.BoxGeometry(2,3,2),P=new THREE.Mesh(T,s);P.position.set(0,0,-6);var C=P.clone();C.position.set(0,0,6),this.mesh.add(P),this.mesh.add(C)};Pilot.prototype.updateHairs=function(){for(var e=this.hairsTop.children,a=e.length,n=0;n<a;n++)e[n].scale.y=.75+.25*Math.cos(this.angleHairs+n/3);this.angleHairs+=game.speed*deltaTime*40};var AirPlane=function(){this.mesh=new THREE.Object3D,this.mesh.name="airPlane";var e=new THREE.BoxGeometry(80,50,50,1,1,1),a=new THREE.MeshPhongMaterial({color:Colors.darkGreen,shading:THREE.FlatShading});e.vertices[4].y-=10,e.vertices[4].z+=20,e.vertices[5].y-=10,e.vertices[5].z-=20,e.vertices[6].y+=30,e.vertices[6].z+=20,e.vertices[7].y+=30,e.vertices[7].z-=20;var n=new THREE.Mesh(e,a);n.castShadow=!0,n.receiveShadow=!0,this.mesh.add(n);var i=new THREE.BoxGeometry(20,50,50,1,1,1),s=new THREE.MeshPhongMaterial({color:Colors.white,shading:THREE.FlatShading}),o=new THREE.Mesh(i,s);o.position.x=50,o.castShadow=!0,o.receiveShadow=!0,this.mesh.add(o);var t=new THREE.BoxGeometry(15,20,5,1,1,1),r=new THREE.MeshPhongMaterial({color:Colors.sky,shading:THREE.FlatShading}),l=new THREE.Mesh(t,r);l.position.set(-40,20,0),l.castShadow=!0,l.receiveShadow=!0,this.mesh.add(l);var m=new THREE.BoxGeometry(30,5,120,1,1,1),h=new THREE.MeshPhongMaterial({color:Colors.sky,shading:THREE.FlatShading}),d=new THREE.Mesh(m,h);d.position.set(0,15,0),d.castShadow=!0,d.receiveShadow=!0,this.mesh.add(d);var p=new THREE.BoxGeometry(3,15,20,1,1,1),c=new THREE.MeshPhongMaterial({color:Colors.white,transparent:!0,opacity:.3,shading:THREE.FlatShading}),$=new THREE.Mesh(p,c);$.position.set(5,27,0),$.castShadow=!0,$.receiveShadow=!0,this.mesh.add($);var g=new THREE.BoxGeometry(20,10,10,1,1,1);g.vertices[4].y-=5,g.vertices[4].z+=5,g.vertices[5].y-=5,g.vertices[5].z-=5,g.vertices[6].y+=5,g.vertices[6].z+=5,g.vertices[7].y+=5,g.vertices[7].z-=5;var w=new THREE.MeshPhongMaterial({color:Colors.brown,shading:THREE.FlatShading});this.propeller=new THREE.Mesh(g,w),this.propeller.castShadow=!0,this.propeller.receiveShadow=!0;var y=new THREE.BoxGeometry(1,80,10,1,1,1),v=new THREE.MeshPhongMaterial({color:Colors.brownDark,shading:THREE.FlatShading}),u=new THREE.Mesh(y,v);u.position.set(8,0,0),u.castShadow=!0,u.receiveShadow=!0;var f=u.clone();f.rotation.x=Math.PI/2,f.castShadow=!0,f.receiveShadow=!0,this.propeller.add(u),this.propeller.add(f),this.propeller.position.set(60,0,0),this.mesh.add(this.propeller);var _=new THREE.BoxGeometry(30,15,10,1,1,1),S=new THREE.MeshPhongMaterial({color:Colors.sky,shading:THREE.FlatShading}),M=new THREE.Mesh(_,S);M.position.set(25,-20,25),this.mesh.add(M);var x=new THREE.BoxGeometry(24,24,4),T=new THREE.MeshPhongMaterial({color:Colors.brownDark,shading:THREE.FlatShading}),P=new THREE.Mesh(x,T);P.position.set(25,-28,25);var C=new THREE.BoxGeometry(10,10,6),L=new THREE.MeshPhongMaterial({color:Colors.brown,shading:THREE.FlatShading}),I=new THREE.Mesh(C,L);P.add(I),this.mesh.add(P);var H=M.clone();H.position.z=-M.position.z,this.mesh.add(H);var E=P.clone();E.position.z=-P.position.z,this.mesh.add(E);var B=P.clone();B.scale.set(.5,.5,.5),B.position.set(-35,-5,0),this.mesh.add(B);var D=new THREE.BoxGeometry(4,20,4);D.applyMatrix(new THREE.Matrix4().makeTranslation(0,10,0));var b=new THREE.MeshPhongMaterial({color:Colors.sky,shading:THREE.FlatShading}),z=new THREE.Mesh(D,b);z.position.set(-35,-5,0),z.rotation.z=-.3,this.mesh.add(z),this.pilot=new Pilot,this.pilot.mesh.position.set(-10,27,0),this.mesh.add(this.pilot.mesh),this.mesh.castShadow=!0,this.mesh.receiveShadow=!0};function createPlane(){(airplane=new AirPlane).mesh.scale.set(.25,.25,.25),airplane.mesh.position.y=game.planeDefaultHeight,scene.add(airplane.mesh)}function createSea(){(sea=new Sea).mesh.position.y=-game.seaRadius,scene.add(sea.mesh)}function createSky(){(sky=new Sky).mesh.position.y=-game.seaRadius,scene.add(sky.mesh)}function createCoins(){coinsHolder=new CoinsHolder(20),scene.add(coinsHolder.mesh)}function createEnnemies(){for(var e=0;e<10;e++){var a=new Ennemy;ennemiesPool.push(a)}ennemiesHolder=new EnnemiesHolder,scene.add(ennemiesHolder.mesh)}function createParticles(){for(var e=0;e<10;e++){var a=new Particle;particlesPool.push(a)}particlesHolder=new ParticlesHolder,scene.add(particlesHolder.mesh)}function setTopScore(e){let a=parseInt(localStorage.getItem("topScore"));e>a&&(localStorage.setItem("topScore",e),document.getElementById("topoftop").innerHTML=""+e)}function getScore(){return parseInt(localStorage.getItem("topScore"))}function loop(){if(deltaTime=(newTime=new Date().getTime())-oldTime,oldTime=newTime,"playing"==game.status)Math.floor(game.distance)%game.distanceForCoinsSpawn==0&&Math.floor(game.distance)>game.coinLastSpawn&&(game.coinLastSpawn=Math.floor(game.distance),coinsHolder.spawnCoins()),Math.floor(game.distance)%game.distanceForSpeedUpdate==0&&Math.floor(game.distance)>game.speedLastUpdate&&(game.speedLastUpdate=Math.floor(game.distance),game.targetBaseSpeed+=game.incrementSpeedByTime*deltaTime),Math.floor(game.distance)%game.distanceForEnnemiesSpawn==0&&Math.floor(game.distance)>game.ennemyLastSpawn&&(game.ennemyLastSpawn=Math.floor(game.distance),ennemiesHolder.spawnEnnemies()),Math.floor(game.distance)%game.distanceForLevelUpdate==0&&Math.floor(game.distance)>game.levelLastUpdate&&(game.levelLastUpdate=Math.floor(game.distance),game.level++,fieldLevel.innerHTML=Math.floor(game.level),game.targetBaseSpeed=game.initSpeed+game.incrementSpeedByLevel*game.level),updatePlane(),updateDistance(),updateEnergy(),game.baseSpeed+=(game.targetBaseSpeed-game.baseSpeed)*deltaTime*.02,game.speed=game.baseSpeed*game.planeSpeed;else if("gameover"==game.status){if(game.speed*=.99,airplane.mesh.rotation.z+=(-Math.PI/2-airplane.mesh.rotation.z)*2e-4*deltaTime,airplane.mesh.rotation.x+=3e-4*deltaTime,game.planeFallSpeed*=1.05,airplane.mesh.position.y-=game.planeFallSpeed*deltaTime,setTopScore(Math.floor(game.distance)),airplane.mesh.position.y<-200){showReplay(),game.status="waitingReplay";let e=new Audio("img/gameover.mp3");e.play(),loopSound.pause(),loopSound.currentTime=0}}else game.status;airplane.propeller.rotation.x+=.2+game.planeSpeed*deltaTime*.005,sea.mesh.rotation.z+=game.speed*deltaTime,sea.mesh.rotation.z>2*Math.PI&&(sea.mesh.rotation.z-=2*Math.PI),ambientLight.intensity+=(.5-ambientLight.intensity)*deltaTime*.005,coinsHolder.rotateCoins(),ennemiesHolder.rotateEnnemies(),sky.moveClouds(),sea.moveWaves(),renderer.render(scene,camera),requestAnimationFrame(loop)}function updateDistance(){game.distance+=game.speed*deltaTime*game.ratioSpeedDistance,fieldDistance.innerHTML=Math.floor(game.distance);var e=502*(1-game.distance%game.distanceForLevelUpdate/game.distanceForLevelUpdate);levelCircle.setAttribute("stroke-dashoffset",e)}(Sky=function(){this.mesh=new THREE.Object3D,this.nClouds=20,this.clouds=[];for(var e=2*Math.PI/this.nClouds,a=0;a<this.nClouds;a++){var n=new Cloud;this.clouds.push(n);var i=e*a,s=game.seaRadius+150+200*Math.random();n.mesh.position.y=Math.sin(i)*s,n.mesh.position.x=Math.cos(i)*s,n.mesh.position.z=-300-500*Math.random(),n.mesh.rotation.z=i+Math.PI/2;var o=1+2*Math.random();n.mesh.scale.set(o,o,o),this.mesh.add(n.mesh)}}).prototype.moveClouds=function(){for(var e=0;e<this.nClouds;e++)this.clouds[e].rotate();this.mesh.rotation.z+=game.speed*deltaTime},(Sea=function(){var e=new THREE.CylinderGeometry(game.seaRadius,game.seaRadius,game.seaLength,40,10);e.applyMatrix(new THREE.Matrix4().makeRotationX(-Math.PI/2)),e.mergeVertices();var a=e.vertices.length;this.waves=[];for(var n=0;n<a;n++){var i=e.vertices[n];this.waves.push({y:i.y,x:i.x,z:i.z,ang:Math.random()*Math.PI*2,amp:game.wavesMinAmp+Math.random()*(game.wavesMaxAmp-game.wavesMinAmp),speed:game.wavesMinSpeed+Math.random()*(game.wavesMaxSpeed-game.wavesMinSpeed)})}var s=new THREE.MeshPhongMaterial({color:Colors.sea,transparent:!0,opacity:.8,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(e,s),this.mesh.name="waves",this.mesh.receiveShadow=!0}).prototype.moveWaves=function(){for(var e=this.mesh.geometry.vertices,a=e.length,n=0;n<a;n++){var i=e[n],s=this.waves[n];i.x=s.x+Math.cos(s.ang)*s.amp,i.y=s.y+Math.sin(s.ang)*s.amp,s.ang+=s.speed*deltaTime,this.mesh.geometry.verticesNeedUpdate=!0}},(Cloud=function(){this.mesh=new THREE.Object3D,this.mesh.name="cloud";for(var e=new THREE.CubeGeometry(20,20,20),a=new THREE.MeshPhongMaterial({color:Colors.sea}),n=3+Math.floor(3*Math.random()),i=0;i<n;i++){var s=new THREE.Mesh(e.clone(),a);s.position.x=15*i,s.position.y=10*Math.random(),s.position.z=10*Math.random(),s.rotation.z=Math.random()*Math.PI*2,s.rotation.y=Math.random()*Math.PI*2;var o=.1+.9*Math.random();s.scale.set(o,o,o),this.mesh.add(s),s.castShadow=!0,s.receiveShadow=!0}}).prototype.rotate=function(){for(var e=this.mesh.children.length,a=0;a<e;a++){var n=this.mesh.children[a];n.rotation.z+=.005*Math.random()*(a+1),n.rotation.y+=.002*Math.random()*(a+1)}},Ennemy=function(){var e=new THREE.TetrahedronGeometry(8,2),a=new THREE.MeshPhongMaterial({color:Colors.stone,shininess:0,specular:16777215,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(e,a),this.mesh.castShadow=!0,this.angle=0,this.dist=0},(EnnemiesHolder=function(){this.mesh=new THREE.Object3D,this.ennemiesInUse=[]}).prototype.spawnEnnemies=function(){for(var e,a=game.level,n=0;n<a;n++)(e=ennemiesPool.length?ennemiesPool.pop():new Ennemy).angle=-(.1*n),e.distance=game.seaRadius+game.planeDefaultHeight+(-1+2*Math.random())*(game.planeAmpHeight-20),e.mesh.position.y=-game.seaRadius+Math.sin(e.angle)*e.distance,e.mesh.position.x=Math.cos(e.angle)*e.distance,this.mesh.add(e.mesh),this.ennemiesInUse.push(e)},EnnemiesHolder.prototype.rotateEnnemies=function(){for(var e=0;e<this.ennemiesInUse.length;e++){var a=this.ennemiesInUse[e];a.angle+=game.speed*deltaTime*game.ennemiesSpeed,a.angle>2*Math.PI&&(a.angle-=2*Math.PI),a.mesh.position.y=-game.seaRadius+Math.sin(a.angle)*a.distance,a.mesh.position.x=Math.cos(a.angle)*a.distance,a.mesh.rotation.z+=.1*Math.random(),a.mesh.rotation.y+=.1*Math.random();var n=airplane.mesh.position.clone().sub(a.mesh.position.clone()),i=n.length();if(i<game.ennemyDistanceTolerance){let s=new Audio("img/rockhit.mp3");s.play(),particlesHolder.spawnParticles(a.mesh.position.clone(),15,Colors.red,3),ennemiesPool.unshift(this.ennemiesInUse.splice(e,1)[0]),this.mesh.remove(a.mesh),game.planeCollisionSpeedX=100*n.x/i,game.planeCollisionSpeedY=100*n.y/i,ambientLight.intensity=2,removeEnergy(),e--}else a.angle>Math.PI&&(ennemiesPool.unshift(this.ennemiesInUse.splice(e,1)[0]),this.mesh.remove(a.mesh),e--)}},(Particle=function(){var e=new THREE.TetrahedronGeometry(3,0),a=new THREE.MeshPhongMaterial({color:Colors.sea,shininess:0,specular:16777215,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(e,a)}).prototype.explode=function(e,a,n){var i=this,s=this.mesh.parent;this.mesh.material.color=new THREE.Color(a),this.mesh.material.needsUpdate=!0,this.mesh.scale.set(n,n,n);var o=e.x+(-1+2*Math.random())*50,t=e.y+(-1+2*Math.random())*50,r=.6+.2*Math.random();TweenMax.to(this.mesh.rotation,r,{x:12*Math.random(),y:12*Math.random()}),TweenMax.to(this.mesh.scale,r,{x:.1,y:.1,z:.1}),TweenMax.to(this.mesh.position,r,{x:o,y:t,delay:.1*Math.random(),ease:Power2.easeOut,onComplete:function(){s&&s.remove(i.mesh),i.mesh.scale.set(1,1,1),particlesPool.unshift(i)}})},(ParticlesHolder=function(){this.mesh=new THREE.Object3D,this.particlesInUse=[]}).prototype.spawnParticles=function(e,a,n,i){for(var s,o=a,t=0;t<o;t++)s=particlesPool.length?particlesPool.pop():new Particle,this.mesh.add(s.mesh),s.mesh.visible=!0,s.mesh.position.y=e.y,s.mesh.position.x=e.x,s.explode(e,n,i)},Coin=function(){var e=new THREE.TetrahedronGeometry(5,0),a=new THREE.MeshPhongMaterial({color:16763904,shininess:1,specular:16777215,shading:THREE.FlatShading});this.mesh=new THREE.Mesh(e,a),this.mesh.castShadow=!0,this.angle=0,this.dist=0},(CoinsHolder=function(e){this.mesh=new THREE.Object3D,this.coinsInUse=[],this.coinsPool=[];for(var a=0;a<e;a++){var n=new Coin;this.coinsPool.push(n)}}).prototype.spawnCoins=function(){for(var e,a=1+Math.floor(10*Math.random()),n=game.seaRadius+game.planeDefaultHeight+(-1+2*Math.random())*(game.planeAmpHeight-20),i=10+Math.round(10*Math.random()),s=0;s<a;s++)e=this.coinsPool.length?this.coinsPool.pop():new Coin,this.mesh.add(e.mesh),this.coinsInUse.push(e),e.angle=-(.02*s),e.distance=n+Math.cos(.5*s)*i,e.mesh.position.y=-game.seaRadius+Math.sin(e.angle)*e.distance,e.mesh.position.x=Math.cos(e.angle)*e.distance},CoinsHolder.prototype.rotateCoins=function(){for(var e=0;e<this.coinsInUse.length;e++){var a=this.coinsInUse[e];if(!a.exploding){if(a.angle+=game.speed*deltaTime*game.coinsSpeed,a.angle>2*Math.PI&&(a.angle-=2*Math.PI),a.mesh.position.y=-game.seaRadius+Math.sin(a.angle)*a.distance,a.mesh.position.x=Math.cos(a.angle)*a.distance,a.mesh.rotation.z+=.1*Math.random(),a.mesh.rotation.y+=.1*Math.random(),airplane.mesh.position.clone().sub(a.mesh.position.clone()).length()<game.coinDistanceTolerance){this.coinsPool.unshift(this.coinsInUse.splice(e,1)[0]),this.mesh.remove(a.mesh),particlesHolder.spawnParticles(a.mesh.position.clone(),5,Colors.yellow,.8),addEnergy(),game.coinTaken++,coinTaken.innerHTML=game.coinTaken;let n=new Audio("img/coingain.mp3");n.play(),e--}else a.angle>Math.PI&&(this.coinsPool.unshift(this.coinsInUse.splice(e,1)[0]),this.mesh.remove(a.mesh),e--)}}};var blinkEnergy=!1;function updateEnergy(){game.energy-=game.speed*deltaTime*game.ratioSpeedEnergy,game.energy=Math.max(0,game.energy),energyBar.style.right=100-game.energy+"%",energyBar.style.backgroundColor=game.energy<50?"#f25346":"#68c3c0",game.energy<30?energyBar.style.animationName="blinking":energyBar.style.animationName="none",game.energy<1&&(game.status="gameover")}function addEnergy(){game.energy+=game.coinValue,game.energy=Math.min(game.energy,100)}function removeEnergy(){game.energy-=game.ennemyValue,game.energy=Math.max(0,game.energy)}function updatePlane(){game.planeSpeed=normalize(mousePos.x,-.5,.5,game.planeMinSpeed,game.planeMaxSpeed);var e=normalize(mousePos.y,-.75,.75,game.planeDefaultHeight-game.planeAmpHeight,game.planeDefaultHeight+game.planeAmpHeight),a=normalize(mousePos.x,-1,1,-(.7*game.planeAmpWidth),-game.planeAmpWidth);game.planeCollisionDisplacementX+=game.planeCollisionSpeedX,a+=game.planeCollisionDisplacementX,game.planeCollisionDisplacementY+=game.planeCollisionSpeedY,e+=game.planeCollisionDisplacementY,airplane.mesh.position.y+=(e-airplane.mesh.position.y)*deltaTime*game.planeMoveSensivity,airplane.mesh.position.x+=(a-airplane.mesh.position.x)*deltaTime*game.planeMoveSensivity,airplane.mesh.rotation.z=(e-airplane.mesh.position.y)*deltaTime*game.planeRotXSensivity,airplane.mesh.rotation.x=(airplane.mesh.position.y-e)*deltaTime*game.planeRotZSensivity,normalize(game.planeSpeed,game.planeMinSpeed,game.planeMaxSpeed,game.cameraNearPos,game.cameraFarPos),camera.fov=normalize(mousePos.x,-1,1,40,80),camera.updateProjectionMatrix(),camera.position.y+=(airplane.mesh.position.y-camera.position.y)*deltaTime*game.cameraSensivity,game.planeCollisionSpeedX+=(0-game.planeCollisionSpeedX)*deltaTime*.03,game.planeCollisionDisplacementX+=(0-game.planeCollisionDisplacementX)*deltaTime*.01,game.planeCollisionSpeedY+=(0-game.planeCollisionSpeedY)*deltaTime*.03,game.planeCollisionDisplacementY+=(0-game.planeCollisionDisplacementY)*deltaTime*.01,airplane.pilot.updateHairs()}function showReplay(){replayMessage.style.display="block"}function hideReplay(){replayMessage.style.display="none"}function normalize(e,a,n,i,s){return i+(Math.max(Math.min(e,n),a)-a)/(n-a)*(s-i)}function init(e){isNaN(getScore())?(localStorage.setItem("topScore",0),document.getElementById("topoftop").innerHTML="0"):document.getElementById("topoftop").innerHTML=""+getScore(),fieldDistance=document.getElementById("distValue"),energyBar=document.getElementById("energyBar"),replayMessage=document.getElementById("replayMessage"),fieldLevel=document.getElementById("levelValue"),levelCircle=document.getElementById("levelCircleStroke"),coinTaken=document.getElementById("coinTaken"),resetGame(),createScene(),createLights(),createPlane(),createSea(),createSky(),createCoins(),createEnnemies(),createParticles(),document.addEventListener("mousemove",handleMouseMove,!1),document.addEventListener("touchmove",handleTouchMove,!1),document.addEventListener("mouseup",handleMouseUp,!1),document.addEventListener("touchend",handleTouchEnd,!1),isMobile(),loop()}function isMobile(){if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))return!1;{document.getElementById("mainheading").style.display="none";let e=document.getElementById("myHeader");return e.style.transform="scale(0.75)",!0}}function addEvents(){document.getElementById("closeBtn").addEventListener("mousedown",()=>{document.body.removeChild(document.getElementById("overlay")),loopSound=document.getElementById("loopSound"),init()})}window.addEventListener("load",addEvents,!1);